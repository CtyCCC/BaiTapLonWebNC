<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Product Management</title>
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" th:href="@{/public/vendor/bootstrap/css/bootstrap.min.css}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" th:href="@{/public/fonts/font-awesome-4.7.0/css/font-awesome.min.css}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" th:href="@{/public/fonts/themify/themify-icons.css}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" th:href="@{/public/fonts/Linearicons-Free-v1.0.0/icon-font.min.css}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" th:href="@{/public/fonts/elegant-font/html-css/style.css}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" th:href="@{/public/vendor/animate/animate.css}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" th:href="@{/public/vendor/css-hamburgers/hamburgers.min.css}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" th:href="@{/public/vendor/animsition/css/animsition.min.css}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" th:href="@{/public/vendor/select2/select2.min.css}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" th:href="@{/public/vendor/slick/slick.css}">
    <!--===============================================================================================-->

    <link rel="stylesheet" type="text/css" th:href="@{/public/stylesheets/util.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/public/stylesheets/main.css}">

    <link type="text/css" rel="stylesheet" th:href="@{/public/vendor/bootstrap/css/bootstrap(signup).css}">
    <link type="text/css" rel="stylesheet" th:href="@{/public/vendor/bootstrap/css/bootstrap-theme.css}">
</head>
<style>
	.selected {
		background-color: #f2f2f2;
	}
</style>
<body>
    <header class="header1">
        <!-- Header desktop -->
        <div class="container-menu-header">
            <div class="topbar">
                <div class="topbar-social">
                    <a href="https://www.facebook.com/Dc.Koool" class="topbar-social-item fa fa-facebook"></a>
                    <a href="https://www.instagram.com/dckoool/" class="topbar-social-item fa fa-instagram"></a>
                    <a href="https://www.pinterest.com/" class="topbar-social-item fa fa-pinterest-p"></a>
                    <a href="https://www.youtube.com/" class="topbar-social-item fa fa-youtube-play"></a>
                </div>

                <span class="topbar-child1">
                        Miễn phí vận chuyển với đơn hàng trên 500k
                    </span>

                <div class="topbar-child2">
                        <span class="topbar-email">
                            support@cccstore.tk
                        </span>
                </div>
            </div>

            <div class="wrap_header">
                <!-- Logo -->
                <a href="/" class="logo">
                    <img th:src="@{/public/images/icons/lg.png}" alt="IMG-LOGO">
                </a>

                <!-- Menu -->
                <div class="wrap_menu">
                    <nav class="menu">
                        <ul class="main_menu">
                            <li >
                                <a href="/webBH/">Trang chủ</a>
                            </li>
                            <li style="text-shadow: 1px 1px grey">
                                <a href="/webBH/productMgmt" >Quản Lý Sản Phẩm</a>
                            </li>

                            <li>
                                <a href="/webBH/orderMgmt">Quản Lý Hóa đơn</a>
                            </li>

                            <li >
                                <a href="/webBH/userMgmt">Quản Lý Khách hàng</a>
                            </li>
                        </ul>
                    </nav>
                </div>

                <!-- Header Icon -->
                <div class="header-icons">
                    <div hidden="" id="thongtinKH" class="header-wrapicon2">
                        <img th:src="@{/public/images/icons/icon-header-01.png}" class="header-icon1 js-show-header-dropdown" alt="ICON">
                        <!-- Header cart noti -->
                        <div class="header-cart header-dropdown">
                            <ul class="header-cart-wrapitem">
								<li class="header-cart-item">
									<div class="header-cart-item-txt">
										<a id="tenKH" class="header-cart-item-name font-weight-bold text-danger" th:text="${user.userName}">
											Nguyễn Văn Mạnh Cường
										</a>
									</div>
								</li>

								<li class="header-cart-item">
									<div class="header-cart-item-txt">
										<a id="emailKH" class="header-cart-item-name" th:text="${user.email}">
											cuongfpi1313131@gmail.com
										</a>
									</div>
								</li>
								<li class="header-cart-item">
									<div class="header-cart-item-txt">
										<a id="sdtKH" class="header-cart-item-name" th:text="${user.phone}">
											0987767216
										</a>
									</div>
								</li>
							</ul>

                            <div class="header-cart-buttons">
                                <div class="header-cart-wrapbtn">
                                    <!-- Button -->
                                    <a href="logout" class="flex-c-m size1 bg1 bo-rad-15 hov1 s-text1 trans-0-4">
                                        <button onclick="dx()">Đăng xuất</button>
                                    </a>
                                </div>

                            </div>
                        </div>
                    </div>

                    <button id="btndangnhap" class="header-wrapicon1 dis-block">
                        <a href="login">
                            <img th:src="@{/public/images/icons/icon-header-01.png}" class="header-icon1" alt="ICON">
                        </a>
                    </button>

                    <span class="linedivide1"></span>

                    <div class="header-wrapicon2">
                        <a href="cart"><img th:src="@{/public/images/icons/icon-header-02.png}" class="header-icon1 js-show-header-dropdown" alt="ICON"></a>
                        <span class="header-icons-noti" id="cart-noti">0</span>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <div class="container-fluid" style="padding: 2%">

        <div class="col-xs-12" style="padding-bottom: 2%">
            <div class="pull-right">
                <button type="button" class="btn btn-default" id="btnThem">Thêm</button>
                <button type="button" class="btn btn-default" id="btnSua" hidden="">Sửa</button>
                <button type="button" class="btn btn-warning" id="btnHuy" hidden="">Hủy</button>
                <button type="button" class="btn btn-danger" id="btnXoa" hidden="">Xóa</button>
                <button type="button" class="btn btn-info" id="btnLuuSua" hidden="">Lưu</button>
                <button type="button" class="btn btn-info" id="btnLuuThem" hidden="">Lưu</button>
            </div>
        </div>

        <div class= "col-xs-12" >
        	<div class="col-xs-7  border border-primary" style="padding:2%">
        		<form class="col-xs-12" style="padding:0">
		            <div class="form-row col-xs-3" hidden="">
		                <label>ID: </label>
		                <input id="id" readonly type="text" class="form-control">
		            </div>
		            <div class="form-row col-xs-5">
		                <label>Tên sản phẩm: </label>
		                <input id="name" readonly type="text" required="required" class="form-control" placeholder="Nhập tên...">
		            </div>
		            <div class="form-row col-xs-4">
		             	<label>Loại: </label>
		                <select class="form-control" id="type" style="height: 35px" disabled>
		                	<option>Car</option>
		                	<option>Accessories</option>
		                </select>
		            </div>
		            <div class="form-row col-xs-3">
		                <label>Năm sản xuất: </label>
		                <input id="year" readonly type="number" class="form-control" placeholder="Nhập năm..." required="required" min="1900" max ="2019">
		            </div>
		            <div class="form-row col-xs-5">
		                <label>Nhà cung cấp: </label>
		                <input id="sup" readonly type="text" required="required" class="form-control" placeholder="Nhập nhà cung cấp...">
		            </div>
		            
		            <div class="form-row col-xs-4">
		                <label>Giá đề xuất: </label>
		                <input id="price" readonly type="number" min="0" required="required" class="form-control" placeholder="Nhập giá...">
		            </div>
		            <div class="form-row col-xs-3" hidden="" id="frameImg">
		                <label>URL ảnh: </label>
		                <input id="urlimageeFile" accept="image/*" type="file" required="required" class="form-control">
		            </div>
		            <div class="form-row col-xs-12">
		                <label>Mô tả: </label>
		                <textarea  id="des" class="form-control" name="" required="required" rows="3" disabled style="resize: none" 
		                  placeholder="Enter description..."></textarea> 
		            </div>
		            
		            <!-- cái này chỉ dùng để lưu tạm -->
		            <div class="form-row col-xs-4" hidden="" id="">
		                <label>URL ảnh: </label>
		                <input id="urlimagee" readonly type="text" class="form-control" placeholder="Nhập link ảnh...">
		            </div>
		        </form>
        	</div>
        	<div class="col-xs-5">
        		<!-- chỗ label này có for = "urlimageeFile", nhưng khi bấm nút sửa mới có-->
        		<label id="changeImg" title="Click here to change picture !!">
                    <img id="hinhxe" width="100%" height="282px" alt="Photo does not match">
                </label>
        	</div>
        </div>
        
        <div class="col-xs-12" style="margin-top: 2%">
            <table id="example1" class="table table-bordered">
              <thead>
              <tr>
                <th>ID</th>
                <th>Tên</th>
                <th>Năm SX</th>
                <th>Nhà cung cấp</th>                  
                <th>Loại</th>             
                <th>Giá</th>
              </tr>
              </thead>
              <tbody>
              <tr th:each="ac : ${listPro}">
                <td th:text="${ac.idPro}">ACC1</td>
                <td th:text="${ac.namePro}">Nguyễn Văn Chiến</td>
                <td th:text="${ac.publicationYear}">Nam</td>
                <td th:text="${ac.supplier}">0794343226</td>
                <td th:text="${ac.type}">0794343226</td>
                <td th:text="${ac.price}">0794343226</td>
                <td th:text="${ac.des}" hidden="">0794343226</td>
                <td th:text="${ac.urlImage}" hidden="">0794343226</td>
              </tr>
              </tbody>
              <tfoot>
              <tr>
                <th>ID</th>
                <th>Tên</th>
                <th>Năm SX</th>
                <th>Nhà cung cấp</th>                  
                <th>Loại</th>             
                <th>Giá</th>
              </tr>
              </tfoot>
            </table>
        </div>
    </div>
    
      <!-- /.box-body -->


<footer class="bg6 p-t-10 p-b-10 p-l-10 p-r-10">
    <div class="t-center p-l-15 p-r-15">
        <div class="t-center s-text8 p-t-20">
            Copyright © 2018 All rights reserved. | From CCC with <i class="fa fa-heart-o" aria-hidden="true"></i>
        </div>
        <p id="isLogin" th:text="${isLogin}" hidden="">0</p>
        <p id="isAdmin" th:text="${user.code}" hidden="">0</p>
    </div>
</footer>

<script type="text/javascript" th:src="@{/public/vendor/jquery/jquery-3.2.1.min.js}"></script>
<!--===============================================================================================-->
<script type="text/javascript" th:src="@{/public/vendor/animsition/js/animsition.min.js}"></script>
<!--===============================================================================================-->
<script type="text/javascript" th:src="@{/public/vendor/bootstrap/js/popper.js}"></script>
<script type="text/javascript" th:src="@{/public/vendor/bootstrap/js/bootstrap.min.js}"></script>
<!--===============================================================================================-->
<script type="text/javascript" th:src="@{/public/vendor/select2/select2.min.js}"></script>

<script th:src="@{/public/javascripts/main.js}"></script>
<script>
$(document).ready(function(){
	  
	$("#example1 tr").click(function() {
		$('#example1 .selected').removeClass('selected');
		$(this).addClass('selected');
		
        $("#btnXoa").removeAttr('hidden');
        $("#btnSua").removeAttr('hidden');
        $("#btnHuy").attr('hidden','true');
        $("#btnLuuThem").attr('hidden','true');
        $("#btnLuuSua").attr('hidden','true');
        $("#frameImg").attr('hidden','true');
        
        $("#name").attr('readonly','true');
        $("#year").attr('readonly','true');
        $("#sup").attr('readonly','true');
        $("#type").attr('disabled','true');
        $("#price").attr('readonly','true');
        $("#des").attr('disabled','true');
        
        
        var id= $(this).find("td:eq(0)").text();
        var name= $(this).find("td:eq(1)").text();
        var year= $(this).find("td:eq(2)").text();
        var sup= $(this).find("td:eq(3)").text();
        var type= $(this).find("td:eq(4)").text();
        var price= $(this).find("td:eq(5)").text();
        var des= $(this).find("td:eq(6)").text();
        var img= $(this).find("td:eq(7)").text();
        
        $("#id").val(id);
        $("#name").val(name);
        $("#year").val(year);
        $("#sup").val(sup);
        $("#type").val(type);
        $("#price").val(price);
        $("#des").val(des);
        $("#urlimagee").val(img);     
        
        $("#hinhxe").attr("src",img);
        
    });
	$("#btnSua").click(function() {
		$("#changeImg").attr('for','urlimageeFile');
		$("#btnHuy").removeAttr('hidden');
		$("#btnLuuSua").removeAttr('hidden');
		$("#btnSua").attr('hidden','true');
		$("#btnXoa").attr('hidden','true');

        $("#name").removeAttr('readonly');
        $("#year").removeAttr('readonly');
        $("#sup").removeAttr('readonly');
        $("#type").removeAttr('disabled');
        $("#price").removeAttr('readonly');
        $("#des").removeAttr('disabled');
    });
	
	$("#btnThem").click(function() {
		$("#hinhxe").attr("src",'');
		$("#changeImg").attr('for','urlimageeFile');
		$("#btnHuy").removeAttr('hidden');
		$("#frameImg").removeAttr('hidden');
		$("#btnSua").attr('hidden','true');
		$("#btnXoa").attr('hidden','true');
		$("#btnLuuThem").removeAttr('hidden');
		
        $("#name").removeAttr('readonly');
        $("#year").removeAttr('readonly');
        $("#sup").removeAttr('readonly');
        $("#type").removeAttr('disabled');
        $("#price").removeAttr('readonly');
        $("#urlimagee").removeAttr('readonly');
        $("#des").removeAttr('disabled');
		
        $("#id").val("");
        $("#name").val("");
        $("#year").val("");
        $("#sup").val("");
        $("#price").val("");
        $("#des").val("");
        $("#urlimagee").val("");
    });
	
	$("#btnHuy").click(function() {
		location.reload();
    });
	
	//đổi hình trên giao diện khi chọn hình, chưa lưu db
	$("#urlimageeFile").change(function() {
		var filename = $('#urlimageeFile').val().replace(/C:\\fakepath\\/i, '');
		$("#hinhxe").attr("src",'public/images/'+filename);
    });
		
	$("#btnXoa").click(function() {
		var id= $("#id").val();
		if (confirm('Bạn chắc muốn xóa? Sẽ không xóa được những mặt hàng đã từng được mua!!')){
			$.ajax({
		        type: "post",
		        url: "/webBH/deletePro",  
		        data:{ idPro: id , chien : "chien"},
		        success: function(){
		        	console.log("send success to server");
		        	location.reload();
		        },
		        error: function(){      
		         alert('Error while request..');
		        }
			});
		}
    });
	
	$("#btnLuuSua").click(function() {
		
		var id = $("#id").val();
		var name = $("#name").val();
        var year = $("#year").val();
        var sup = $("#sup").val();
        var type = $("#type").val();
        var price = $("#price").val();
        var des = $("#des").val();
        var filename = $('#urlimageeFile').val().replace(/C:\\fakepath\\/i, '');
        var url = $("#urlimagee").val();
        var link='';
        //alert(filename);
  		if (filename ===''){
  			link = url+'';
  		}else{
  			link = 'public/images/' + filename;
  		}
  			
        if (confirm('Bạn muốn lưu không?')){
			$.ajax({
		        type: "post",
		        url: "/webBH/editPro",  
		        data:{ id: id, name :name, year : year, sup: sup, type: type, price :price, des: des, url :link},
		        success: function(){
		        	console.log("send success to server");
		        	location.reload();
		        },
		        error: function(){      
		         alert('Error while request..');
		        }
			});
		}
    });
	
	$("#btnLuuThem").click(function() {
		
		var name = $("#name").val();
        var year = $("#year").val();
        var sup = $("#sup").val();
        var type = $("#type").val();
        var price = $("#price").val();
        var des = $("#des").val();
        var filename = $('#urlimageeFile').val().replace(/C:\\fakepath\\/i, '');
        
        if (validateWithoutSubmit()){
        	if (confirm('Bạn muốn lưu không?')){
    			$.ajax({
    		        type: "post",
    		        url: "/webBH/addPro",  
    		        data:{name :name, year : year, sup: sup, type: type, price :price, des: des, url :filename},
    		        success: function(){
    		        	console.log("send success to server");
    		        	location.reload();
    		        },
    		        error: function(){      
    		         alert('Error while request..');
    		        }
    			});
    		}
        }
    });
	
	if($("#isLogin").text()=="ok"){
		$("#thongtinKH").removeAttr('hidden');
		$("#btndangnhap").attr('hidden', 'true');
	}else {
		$("#btndangnhap").removeAttr('hidden');
		$("#thongtinKH").attr('hidden', 'true');
	}
	
	
});
function validateWithoutSubmit() {
	  var name = document.getElementById("name");
	  var year = document.getElementById("year");
	  var ncc = document.getElementById("sup");
	  var price = document.getElementById("price");
	  var url = document.getElementById("urlimageeFile");
	  var des = document.getElementById("des");
	  
	  if (!name.checkValidity()){
		    alert('Tên sản phẩm là bắt buộc !!');
		    return false;
	  }
	  if (!year.checkValidity()) {
	    alert('Năm ko hợp lệ !! (1900-2019)');
	    return false;
	  }
	  
	  if (!ncc.checkValidity()){
	    alert('Nhà cung cấp là bắt buộc');
	    return false;
	  }
	  if (!price.checkValidity()){
	    alert('Giá không hợp lệ !!');
	    return false;
	  }
	  if (!url.checkValidity()){
	    alert('Chọn hình ảnh cho sản phẩm !!');
	    return false;
	  }
	  if (!des.checkValidity()){
	    alert('Mô tả không được để trống !!');
	    return false;
	  } 
	  return true;
} 
</script>
</body>
</html>