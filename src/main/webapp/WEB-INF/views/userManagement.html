<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>User Management</title>
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" th:href="@{/public/vendor/bootstrap/css/bootstrap.min.css}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" th:href="@{/public/fonts/font-awesome-4.7.0/css/font-awesome.min.css}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" th:href="@{/public/fonts/themify/themify-icons.css}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" th:href="@{/public/fonts/Linearicons-Free-v1.0.0/icon-font.min.css}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" th:href="@{/public/fonts/elegant-font/html-css/style.css}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" th:href="@{/public/vendor/animate/animate.css}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" th:href="@{/public/vendor/css-hamburgers/hamburgers.min.css}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" th:href="@{/public/vendor/animsition/css/animsition.min.css}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" th:href="@{/public/vendor/select2/select2.min.css}">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" th:href="@{/public/vendor/slick/slick.css}">
    <!--===============================================================================================-->

    <link rel="stylesheet" type="text/css" th:href="@{/public/stylesheets/util.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/public/stylesheets/main.css}">

    <link type="text/css" rel="stylesheet" th:href="@{/public/vendor/bootstrap/css/bootstrap(signup).css}">
    <link type="text/css" rel="stylesheet" th:href="@{/public/vendor/bootstrap/css/bootstrap-theme.css}">

</head>
<style>
	.selected {
		background-color: #f2f2f2;
	}
</style>
<body>
    <header class="header1">
        <!-- Header desktop -->
        <div class="container-menu-header">
            <div class="topbar">
                <div class="topbar-social">
                    <a href="https://www.facebook.com/Dc.Koool" class="topbar-social-item fa fa-facebook"></a>
                    <a href="https://www.instagram.com/dckoool/" class="topbar-social-item fa fa-instagram"></a>
                    <a href="https://www.pinterest.com/" class="topbar-social-item fa fa-pinterest-p"></a>
                    <a href="https://www.youtube.com/" class="topbar-social-item fa fa-youtube-play"></a>
                </div>

                <span class="topbar-child1">
                        Miễn phí vận chuyển với đơn hàng trên 500k
                    </span>

                <div class="topbar-child2">
                        <span class="topbar-email">
                            support@cccstore.tk
                        </span>
                </div>
            </div>

            <div class="wrap_header">
                <!-- Logo -->
                <a href="/" class="logo">
                    <img th:src="@{/public/images/icons/lg.png}" alt="IMG-LOGO">
                </a>

                <!-- Menu -->
                <div class="wrap_menu">
                    <nav class="menu">
                        <ul class="main_menu">
                            <li>
                                <a href="/webBH/">Trang chủ</a>
                            </li>
                            <li>
                                <a href="/webBH/productMgmt" >Quản Lý Sản Phẩm</a>
                            </li>

                            <li>
                                <a href="/webBH/orderMgmt">Quản Lý Hóa đơn</a>
                            </li>

                            <li style="text-shadow: 1px 1px grey">
                                <a href="/webBH/userMgmt">Quản Lý Khách hàng</a>
                            </li>
                        </ul>
                    </nav>
                </div>

                <!-- Header Icon -->
                <div class="header-icons">
                    <div hidden="" id="thongtinKH" class="header-wrapicon2">
                        <img th:src="@{/public/images/icons/icon-header-01.png}" class="header-icon1 js-show-header-dropdown" alt="ICON">
                        <!-- Header cart noti -->
                        <div class="header-cart header-dropdown">
                            <ul class="header-cart-wrapitem">
								<li class="header-cart-item">
									<div class="header-cart-item-txt">
										<a id="tenKH" class="header-cart-item-name font-weight-bold text-danger" th:text="${user.userName}">
											Nguyễn Văn Mạnh Cường
										</a>
									</div>
								</li>

								<li class="header-cart-item">
									<div class="header-cart-item-txt">
										<a id="emailKH" class="header-cart-item-name" th:text="${user.email}">
											cuongfpi1313131@gmail.com
										</a>
									</div>
								</li>
								<li class="header-cart-item">
									<div class="header-cart-item-txt">
										<a id="sdtKH" class="header-cart-item-name" th:text="${user.phone}">
											0987767216
										</a>
									</div>
								</li>
							</ul>

                            <div class="header-cart-buttons">
                                <div class="header-cart-wrapbtn">
                                    <!-- Button -->
                                    <a href="logout" class="flex-c-m size1 bg1 bo-rad-15 hov1 s-text1 trans-0-4">
                                        <button onclick="dx()">Đăng xuất</button>
                                    </a>
                                </div>

                            </div>
                        </div>
                    </div>

                    <button id="btndangnhap" class="header-wrapicon1 dis-block">
                        <a href="Login">
                            <img th:src="@{/public/images/icons/icon-header-01.png}" class="header-icon1" alt="ICON">
                        </a>
                    </button>

                    <span class="linedivide1"></span>

                    <div class="header-wrapicon2">
                        <a href="cart"><img th:src="@{/public/images/icons/icon-header-02.png}" class="header-icon1 js-show-header-dropdown" alt="ICON"></a>
                        <span class="header-icons-noti" id="cart-noti">0</span>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <div class="container-fluid" style="padding: 2%">

        <div class="col-xs-12" style="padding-bottom: 2%">
            <div class="pull-right">
                <button type="button" class="btn btn-default" id="btnThem">Thêm</button>
                <button type="button" class="btn btn-default" id="btnSua" hidden="">Sửa</button>
                <button type="button" class="btn btn-warning" id="btnHuy" hidden="">Hủy</button>
                <button type="button" class="btn btn-danger" id="btnXoa" hidden="">Xóa</button>
                <button type="button" class="btn btn-info" id="btnLuuSua" hidden="">Lưu</button>
                <button type="button" class="btn btn-info" id="btnLuuThem" hidden="">Lưu</button>
            </div>
        </div>

        <form class="col-xs-12">
        	
        	<div class="form-row col-xs-4" hidden="">
                <label>Mã: </label>
                <input id="idAcc" readonly type="text" class="form-control">
            </div>
            
            <div class="form-row col-xs-4">
                <label>Tên khách hàng: </label>
                <input id="nameCus" readonly type="text" class="form-control" placeholder="Nhập tên khách hàng..." required="required">
            </div>
            
            <div class="form-row col-xs-3">
                <label>SDT: </label>
                <input id="phone" readonly type="number" class="form-control" placeholder="Nhập số điện thoại..." min="1111111" required="required">
            </div>
            
            <div class="form-row col-xs-3">
                <label>Email: </label>
                <input id="email" readonly type="email" class="form-control" placeholder="Enter email..." required="required">
            </div>
            
            <div class="form-row col-xs-2">
             	<label>Gới tính: </label>
                <select class="form-control" id="gender"  disabled style="height: 35px">
                	<option value="Nam">Nam</option>
                	<option value="Nữ">Nữ</option>
                </select>
            </div>
            
            
            <div class="form-row col-xs-4">
                <label>Tài khoản: </label>
                <input id="user" readonly type="text" class="form-control" placeholder="Tên đăng nhập..." required="required">
            </div>
            <div class="form-row col-xs-8">
                <label>Địa chỉ: </label>
                <input id="address" readonly type="text" class="form-control" placeholder="Nhập địa chỉ..." required="required">
            </div>
            
            <div class="form-row col-xs-2">
             	<label>Loại user: </label>
                <select class="form-control" id="role" style="height: 35px" disabled>
                	<option>CUS</option>
                	<option>ADM</option>
                </select>
            </div>
            <div class="form-row col-xs-2" id="framepass" hidden="">
                <label>Password: </label>
                <input id="pass" type="password" class="form-control" placeholder="Nhập mật khẩu..." required="required">
            </div>
        </form>
    

        <div class="col-xs-12" style="margin-top: 2%">
            <table id="example1" class="table table-bordered table-hover">
              <thead>
              <tr>
                <th>Mã Account</th>
                <th>Tên KH</th>
                <th>Giới tính</th>
                <th>SDT</th>
                <th>Email</th>              
                <th>Tài khoản</th>
                <th hidden="">Địa chỉ</th>
                <th>Code</th>
                <th hidden="">Pass</th>
              </tr>
              </thead>
              <tbody>
              <tr th:each="ac : ${listAccount}">
                <td th:text="${ac.idAcc}">ACC1</td>
                <td th:text="${ac.nameCus}">Nguyễn Văn Chiến</td>
                <td th:text="${ac.gender}">Nam</td>
                <td th:text="${ac.phone}">0794343226</td>                  
                <td th:text="${ac.email}">nvmcuong97@gmail.com</td>             
                <td th:text="${ac.userName}">admin</td>
                <td th:text="${ac.address}" hidden="">số 11 đường 4-4 quận Tân bình</td>
                <td th:text="${ac.code}">ADM</td>
                <td th:text="${ac.pass}" hidden="">123</td>
              </tr>
              </tbody>
              <tfoot>
              <tr>
                <th>Mã Account</th>
                <th>Tên KH</th>
                <th>Giới tính</th>
                <th>SDT</th>
                <th>Email</th>              
                <th>Tài khoản</th>
                <th hidden="">Địa chỉ</th>
                <th>Code</th>
                <th hidden="">Pass</th>
              </tr>
              </tfoot>
            </table>
        </div>
    </div>
    
      <!-- /.box-body -->


<footer class="bg6 p-t-10 p-b-10 p-l-10 p-r-10">
    <div class="t-center p-l-15 p-r-15">
        <div class="t-center s-text8 p-t-20">
            Copyright © 2018 All rights reserved. | From CCC with <i class="fa fa-heart-o" aria-hidden="true"></i>
        </div>
        <p id="isLogin" th:text="${isLogin}" hidden="">0</p>
        <p id="isAdmin" th:text="${user.code}" hidden="">0</p>
    </div>
</footer>

<script type="text/javascript" th:src="@{/public/vendor/jquery/jquery-3.2.1.min.js}"></script>
<!--===============================================================================================-->
<script type="text/javascript" th:src="@{/public/vendor/animsition/js/animsition.min.js}"></script>
<!--===============================================================================================-->
<script type="text/javascript" th:src="@{/public/vendor/bootstrap/js/popper.js}"></script>
<script type="text/javascript" th:src="@{/public/vendor/bootstrap/js/bootstrap.min.js}"></script>
<!--===============================================================================================-->
<script type="text/javascript" th:src="@{/public/vendor/select2/select2.min.js}"></script>

<script th:src="@{/public/javascripts/main.js}"></script>

<script>
$(document).ready(function(){
	  
	$("#example1 tr").click(function() {
		$('#example1 .selected').removeClass('selected');
		$(this).addClass('selected');
		
        $("#btnXoa").removeAttr('hidden');
        $("#btnSua").removeAttr('hidden');
        $("#btnHuy").attr('hidden','true');
        $("#btnLuuThem").attr('hidden','true');
        $("#btnLuuSua").attr('hidden','true');
        
        $("#nameCus").attr('readonly','true');
        $("#gender").attr('disabled','true');
        $("#phone").attr('readonly','true');
        $("#email").attr('readonly','true');
        $("#address").attr('readonly','true');
        $("#user").attr('readonly','true');
        $("#role").attr('disabled','true');
        
        var maAcc= $(this).find("td:eq(0)").text();
        var tenkh= $(this).find("td:eq(1)").text();
        var gioitinh= $(this).find("td:eq(2)").text();
        var sdt= $(this).find("td:eq(3)").text();
        var email= $(this).find("td:eq(4)").text();
        var taikhoan= $(this).find("td:eq(5)").text();
        var diachi= $(this).find("td:eq(6)").text();
        var loaiuser= $(this).find("td:eq(7)").text();
        var pass= $(this).find("td:eq(8)").text();
        
        $("#nameCus").val(tenkh);
        $("#gender").val(gioitinh);
        $("#phone").val(sdt);
        $("#email").val(email);
        $("#address").val(diachi);
        $("#user").val(taikhoan);
        $("#role").val(loaiuser);
        $("#pass").val(pass);
        $("#idAcc").val(maAcc);
    });
	$("#btnSua").click(function() {
		$("#btnHuy").removeAttr('hidden');
		$("#btnLuuSua").removeAttr('hidden');
		$("#btnSua").attr('hidden','true');
		$("#btnXoa").attr('hidden','true');
		
		$("#nameCus").removeAttr('readonly');
        $("#gender").removeAttr('disabled');
        $("#phone").removeAttr('readonly');
        $("#email").removeAttr('readonly');
        $("#address").removeAttr('readonly');
        //$("#user").removeAttr('readonly');
        //$("#role").removeAttr('disabled');
    });
	$("#btnThem").click(function() {
		$("#btnHuy").removeAttr('hidden');
		$("#framepass").removeAttr('hidden');
		$("#btnSua").attr('hidden','true');
		$("#btnXoa").attr('hidden','true');
		$("#btnLuuThem").removeAttr('hidden');
		$("#btnLuuSua").attr('hidden','true');
		
		$("#nameCus").removeAttr('readonly');
        $("#gender").removeAttr('disabled');
        $("#phone").removeAttr('readonly');
        $("#email").removeAttr('readonly');
        $("#address").removeAttr('readonly');
        $("#user").removeAttr('readonly');
        $("#role").removeAttr('disabled');
		
        $("#nameCus").val("");
        $("#phone").val("");
        $("#email").val("");
        $("#address").val("");
        $("#user").val("");
        $("#pass").val("");
    });
	
	$("#btnHuy").click(function() {
		location.reload();
    });
	
	$("#btnXoa").click(function() {
		var maAcc= $("#idAcc").val();
		if (confirm('Bạn chắc muốn xóa? Sẽ không xóa được những user đã mua hàng!!')){
			$.ajax({
		        type: "post",
		        url: "/webBH/deleteAcc",  
		        data:{ idAcc: maAcc , chien : "chien"},
		        success: function(){
		        	console.log("send success to server");
		        	location.reload();
		        },
		        error: function(){      
		         alert('Error while request..');
		        }
			});
		}
    });
	
	$("#btnLuuSua").click(function() {
		var idAcc = $("#idAcc").val();
		var nameCus = $("#nameCus").val();
        var gender = $("#gender").val();
        var phone = $("#phone").val();
        var email = $("#email").val();
        var address = $("#address").val();
        //var user = $("#user").val();
        //var role = $("#role").val();
        //var pass = $("#pass").val();
  		
        if (validateWithoutSubmitEdit()){
        	if (confirm('Bạn muốn lưu không?')){
    			$.ajax({
    		        type: "post",
    		        url: "/webBH/editAcc",  
    		        data: { idAcc: idAcc , nameCus :nameCus, gender : gender, phone: phone, email:email, address:address},
    		        success: function(){
    		        	console.log("send success to server");
    		        	location.reload();
    		        },
    		        error: function(){      
    		         alert('Error while request..');
    		        }
    			});
    		}
        }
    });
	
	$("#btnLuuThem").click(function() {
		
		var nameCus = $("#nameCus").val();
        var gender = $("#gender").val();
        var phone = $("#phone").val();
        var email = $("#email").val();
        var address = $("#address").val();
        var user = $("#user").val();
        var role = $("#role").val();
        var pass = $("#pass").val();
        
        if (validateWithoutSubmit()){
        	if (confirm('Bạn muốn lưu không?')){
    			$.ajax({
    		        type: "post",
    		        url: "/webBH/addAcc",  
    		        data: { nameCus :nameCus, gender : gender, phone: phone, email:email, address:address, user: user, role:role, pass: pass},
    		        success: function(){
    		        	console.log("send success to server");
    		        	location.reload();
    		        },
    		        error: function(){      
    		         alert('Error while request..');
    		        }
    			});
    		}
        }
    });
	
	//login 
	if($("#isLogin").text()=="ok"){
		$("#thongtinKH").removeAttr('hidden');
		$("#btndangnhap").attr('hidden', 'true');
	}else {
		$("#btndangnhap").removeAttr('hidden');
		$("#thongtinKH").attr('hidden', 'true');
	}
	
});


//validate add new
function validateWithoutSubmit() {
	
	  var name = document.getElementById("nameCus");
	  var phone = document.getElementById("phone");
	  var email = document.getElementById("email");
	  var user = document.getElementById("user");
	  var addr = document.getElementById("address");
	  var pass = document.getElementById("pass");
	  
	  var regUser =  /^[A-Za-z0-9_\.]{8,32}$/;
	  var regSDT = /[0]\d{9}/;
	  
	  var listUser = [];
	  var listEmail = [];
	  var breakOut;
        
	  if (!name.checkValidity()){
		    alert('Tên khách hàng là bắt buộc !!');
		    return false;
	  }
	  if (!regSDT.test(phone.value)) {
		    alert('SDT ko hợp lệ !!');
		    return false;
	  }
	  if (!email.checkValidity()){
		    alert('Email không hợp lệ !!');
		    return false;
	  }
	  if (!regUser.test(user.value)){
		  alert('Tài khoản không hợp lệ !! (8-32 Ko chứa kí tự đặc biệt)');
		  return false;
	  }
	  if (!addr.checkValidity()){
	    alert('Địa chỉ là bắt buộc !!');
	    return false;
	  }
	  if (!regUser.test(pass.value)){
	    alert('Mật khẩu không hợp lệ !! (8-32)');
	    return false;
	  } 
	  //Lấy all user để so sánh trùng
      $('#example1 tr').each(function() {
    	 var tk = $(this).find("td:eq(5)").html();
    	 listUser.push(tk+"");
      });
      jQuery.each( listUser, function( i, val ) {//lặp mảng
      	if (val == user.value){
      		alert('Tài khoản đã tồn tại, nhập một tài khoản khác !!');
      		breakOut = true;
      		return false;	
      	}
      });
      
      //Lấy all email để so sánh trùng
      $('#example1 tr').each(function() {
    	 var mail = $(this).find("td:eq(4)").html();
    	 listEmail.push(mail+"");
      });
      jQuery.each(listEmail, function( i, val ) {//lặp mảng
      	if (val == email.value){
      		alert('Email này đã tồn tại, nhập một email khác !!');
      		breakOut = true;
      		return false;
      	}
      });
      if(breakOut) {
    	  breakOut = false;
    	  return false;
      } 
      
	  return true;
} 
//validate edit
function validateWithoutSubmitEdit() {
	
	  var name = document.getElementById("nameCus");
	  var phone = document.getElementById("phone");
	  var email = document.getElementById("email");
	  var addr = document.getElementById("address");
	  
	  var regSDT = /[0]\d{9}/;
        
	  if (!name.checkValidity()){
		    alert('Tên khách hàng là bắt buộc !!');
		    return false;
	  }
	  if (!regSDT.test(phone.value)) {
		    alert('SDT ko hợp lệ !!');
		    return false;
	  }
	  if (!email.checkValidity()){
		    alert('Email không hợp lệ !!');
		    return false;
	  }
	  if (!addr.checkValidity()){
	    alert('Địa chỉ là bắt buộc !!');
	    return false;
	  }
      
	  return true;
} 
</script>
</body>
</html>